{"ast":null,"code":"// webauthn.js\nexport const createCredential = async email => {\n  const publicKeyCredentialCreationOptions = {\n    challenge: window.crypto.getRandomValues(new Uint8Array(32)),\n    rp: {\n      name: \"Kwaai\"\n    },\n    user: {\n      id: window.crypto.getRandomValues(new Uint8Array(32)),\n      name: email,\n      displayName: email\n    },\n    pubKeyCredParams: [{\n      type: \"public-key\",\n      alg: -7 // ES256 algorithm\n    }, {\n      type: \"public-key\",\n      alg: -257 // RS256 algorithm\n    }],\n    authenticatorSelection: {\n      authenticatorAttachment: \"platform\",\n      userVerification: \"preferred\"\n    },\n    timeout: 120000,\n    attestation: \"direct\"\n  };\n  console.log('PublicKeyCredentialCreationOptions:', publicKeyCredentialCreationOptions);\n  try {\n    console.log('Creating credential...');\n    const credential = await navigator.credentials.create({\n      publicKey: publicKeyCredentialCreationOptions\n    });\n    console.log('Credential created:', credential);\n    return credential;\n  } catch (error) {\n    console.error('Error creating credential:', error);\n    throw error;\n  }\n};\nexport const getCredential = async credentialId => {\n  let decodedId;\n  try {\n    // Ensure the credentialId is URL-safe Base64 encoded\n    const base64CredentialId = credentialId.replace(/-/g, '+').replace(/_/g, '/');\n    decodedId = Uint8Array.from(atob(base64CredentialId), c => c.charCodeAt(0));\n  } catch (error) {\n    console.error('Error decoding credentialId:', error);\n    throw new Error('Invalid credentialId encoding');\n  }\n  const publicKeyCredentialRequestOptions = {\n    challenge: window.crypto.getRandomValues(new Uint8Array(32)),\n    allowCredentials: [{\n      type: \"public-key\",\n      id: decodedId,\n      transports: [\"internal\", \"cross-platform\", \"hybrid\", \"usb\", \"nfc\", \"ble\"] // Ensure compatibility with Safari\n    }],\n    userVerification: \"preferred\",\n    timeout: 60000\n  };\n  try {\n    const assertion = await navigator.credentials.get({\n      publicKey: publicKeyCredentialRequestOptions\n    });\n    return assertion;\n  } catch (error) {\n    console.error('Error getting credential:', error);\n    throw error;\n  }\n};","map":{"version":3,"names":["createCredential","email","publicKeyCredentialCreationOptions","challenge","window","crypto","getRandomValues","Uint8Array","rp","name","user","id","displayName","pubKeyCredParams","type","alg","authenticatorSelection","authenticatorAttachment","userVerification","timeout","attestation","console","log","credential","navigator","credentials","create","publicKey","error","getCredential","credentialId","decodedId","base64CredentialId","replace","from","atob","c","charCodeAt","Error","publicKeyCredentialRequestOptions","allowCredentials","transports","assertion","get"],"sources":["/Users/robertbinning/Documents/GitHub/robertbinning/passkey/src/webauthn.js"],"sourcesContent":["// webauthn.js\nexport const createCredential = async (email) => {\n    const publicKeyCredentialCreationOptions = {\n        challenge: window.crypto.getRandomValues(new Uint8Array(32)),\n        rp: {\n            name: \"Kwaai\"\n        },\n        user: {\n            id: window.crypto.getRandomValues(new Uint8Array(32)),\n            name: email,\n            displayName: email\n        },\n        pubKeyCredParams: [\n            {\n                type: \"public-key\",\n                alg: -7 // ES256 algorithm\n            },\n            {\n                type: \"public-key\",\n                alg: -257 // RS256 algorithm\n            }\n        ],\n        authenticatorSelection: {\n            authenticatorAttachment: \"platform\", \n            userVerification: \"preferred\"\n        },\n        timeout: 120000, \n        attestation: \"direct\"\n    };\n\n    console.log('PublicKeyCredentialCreationOptions:', publicKeyCredentialCreationOptions);\n\n    try {\n        console.log('Creating credential...');\n        const credential = await navigator.credentials.create({\n            publicKey: publicKeyCredentialCreationOptions\n        });\n        console.log('Credential created:', credential);\n        return credential;\n    } catch (error) {\n        console.error('Error creating credential:', error);\n        throw error;\n    }\n};\n\nexport const getCredential = async (credentialId) => {\n    let decodedId;\n    try {\n        // Ensure the credentialId is URL-safe Base64 encoded\n        const base64CredentialId = credentialId.replace(/-/g, '+').replace(/_/g, '/');\n        decodedId = Uint8Array.from(atob(base64CredentialId), c => c.charCodeAt(0));\n    } catch (error) {\n        console.error('Error decoding credentialId:', error);\n        throw new Error('Invalid credentialId encoding');\n    }\n\n    const publicKeyCredentialRequestOptions = {\n        challenge: window.crypto.getRandomValues(new Uint8Array(32)),\n        allowCredentials: [\n            {\n                type: \"public-key\",\n                id: decodedId,\n                transports: [\"internal\", \"cross-platform\", \"hybrid\", \"usb\", \"nfc\", \"ble\"] // Ensure compatibility with Safari\n            }\n        ],\n        userVerification: \"preferred\",\n        timeout: 60000\n    };\n\n    try {\n        const assertion = await navigator.credentials.get({\n            publicKey: publicKeyCredentialRequestOptions\n        });\n        return assertion;\n    } catch (error) {\n        console.error('Error getting credential:', error);\n        throw error;\n    }\n};\n"],"mappings":"AAAA;AACA,OAAO,MAAMA,gBAAgB,GAAG,MAAOC,KAAK,IAAK;EAC7C,MAAMC,kCAAkC,GAAG;IACvCC,SAAS,EAAEC,MAAM,CAACC,MAAM,CAACC,eAAe,CAAC,IAAIC,UAAU,CAAC,EAAE,CAAC,CAAC;IAC5DC,EAAE,EAAE;MACAC,IAAI,EAAE;IACV,CAAC;IACDC,IAAI,EAAE;MACFC,EAAE,EAAEP,MAAM,CAACC,MAAM,CAACC,eAAe,CAAC,IAAIC,UAAU,CAAC,EAAE,CAAC,CAAC;MACrDE,IAAI,EAAER,KAAK;MACXW,WAAW,EAAEX;IACjB,CAAC;IACDY,gBAAgB,EAAE,CACd;MACIC,IAAI,EAAE,YAAY;MAClBC,GAAG,EAAE,CAAC,CAAC,CAAC;IACZ,CAAC,EACD;MACID,IAAI,EAAE,YAAY;MAClBC,GAAG,EAAE,CAAC,GAAG,CAAC;IACd,CAAC,CACJ;IACDC,sBAAsB,EAAE;MACpBC,uBAAuB,EAAE,UAAU;MACnCC,gBAAgB,EAAE;IACtB,CAAC;IACDC,OAAO,EAAE,MAAM;IACfC,WAAW,EAAE;EACjB,CAAC;EAEDC,OAAO,CAACC,GAAG,CAAC,qCAAqC,EAAEpB,kCAAkC,CAAC;EAEtF,IAAI;IACAmB,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAC;IACrC,MAAMC,UAAU,GAAG,MAAMC,SAAS,CAACC,WAAW,CAACC,MAAM,CAAC;MAClDC,SAAS,EAAEzB;IACf,CAAC,CAAC;IACFmB,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAEC,UAAU,CAAC;IAC9C,OAAOA,UAAU;EACrB,CAAC,CAAC,OAAOK,KAAK,EAAE;IACZP,OAAO,CAACO,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;IAClD,MAAMA,KAAK;EACf;AACJ,CAAC;AAED,OAAO,MAAMC,aAAa,GAAG,MAAOC,YAAY,IAAK;EACjD,IAAIC,SAAS;EACb,IAAI;IACA;IACA,MAAMC,kBAAkB,GAAGF,YAAY,CAACG,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC;IAC7EF,SAAS,GAAGxB,UAAU,CAAC2B,IAAI,CAACC,IAAI,CAACH,kBAAkB,CAAC,EAAEI,CAAC,IAAIA,CAAC,CAACC,UAAU,CAAC,CAAC,CAAC,CAAC;EAC/E,CAAC,CAAC,OAAOT,KAAK,EAAE;IACZP,OAAO,CAACO,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAAC;IACpD,MAAM,IAAIU,KAAK,CAAC,+BAA+B,CAAC;EACpD;EAEA,MAAMC,iCAAiC,GAAG;IACtCpC,SAAS,EAAEC,MAAM,CAACC,MAAM,CAACC,eAAe,CAAC,IAAIC,UAAU,CAAC,EAAE,CAAC,CAAC;IAC5DiC,gBAAgB,EAAE,CACd;MACI1B,IAAI,EAAE,YAAY;MAClBH,EAAE,EAAEoB,SAAS;MACbU,UAAU,EAAE,CAAC,UAAU,EAAE,gBAAgB,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;IAC9E,CAAC,CACJ;IACDvB,gBAAgB,EAAE,WAAW;IAC7BC,OAAO,EAAE;EACb,CAAC;EAED,IAAI;IACA,MAAMuB,SAAS,GAAG,MAAMlB,SAAS,CAACC,WAAW,CAACkB,GAAG,CAAC;MAC9ChB,SAAS,EAAEY;IACf,CAAC,CAAC;IACF,OAAOG,SAAS;EACpB,CAAC,CAAC,OAAOd,KAAK,EAAE;IACZP,OAAO,CAACO,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;IACjD,MAAMA,KAAK;EACf;AACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}